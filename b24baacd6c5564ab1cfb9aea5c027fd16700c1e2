{
  "comments": [
    {
      "key": {
        "uuid": "9ab29df4_4296c895",
        "filename": "what_ci_targets.sh",
        "patchSetId": 2
      },
      "lineNbr": 5,
      "author": {
        "id": 1003318
      },
      "writtenOn": "2015-10-27T08:38:58Z",
      "side": 1,
      "message": "extra on.",
      "range": {
        "startLine": 5,
        "startChar": 66,
        "endLine": 5,
        "endChar": 68
      },
      "revId": "b24baacd6c5564ab1cfb9aea5c027fd16700c1e2",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9ab29df4_b02b65ea",
        "filename": "what_ci_targets.sh",
        "patchSetId": 2
      },
      "lineNbr": 76,
      "author": {
        "id": 1002731
      },
      "writtenOn": "2015-10-28T18:24:35Z",
      "side": 1,
      "message": "Mike, here you suggested:\n\n if [ \".$FOR_UNIT\" \u003d\u003d \".0\" ]\n  then\n      echo \"$DESC_NO_CHANGES\"\n      echo \"$FAST_BUILD\"\n      exit 0\n  fi\n\nNote that a FOR_UNIT \u003d\u003d 0 doesn\u0027t imply that FOR_MDTS \u003d\u003d 0. This snippet would skip MDTS tests if, for example, I just edit an MDTS test.\n\nNow, you were suggesting:\n\n  if [ \".$FOR_UNIT\" \u003d\u003d \".1\" ] \u0026\u0026 [ \".$FOR_MDTS\" \u003d\u003d \".1\" ] \u0026\u0026 [ $(git diff-tree --no-commit-id --name-only -r HEAD build.gradle) ]\n\n\nI think this is not so correct. Note that apart of the build.gradle version bump, you could edit any file included in REGEX_FOR_MDTS and still get a FOR_MDTS \u003d\u003d 1 which would result in recommending a fast build incorrectly.\n\nInstead the code on patch 6/7 is more explicit looking for a positive match on the case we want to catch. Once we know that FOR_UNIT \u003d\u003d 1, we check the whole changeset, no filters, and search precisely for a single change in the midonetVersion line. Only if this matches will we allow the \"version bump\" mode. \n\nOtherwise it falls back to full build.",
      "revId": "b24baacd6c5564ab1cfb9aea5c027fd16700c1e2",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9ab29df4_6b03a0b8",
        "filename": "what_ci_targets.sh",
        "patchSetId": 2
      },
      "lineNbr": 76,
      "author": {
        "id": 1003629
      },
      "writtenOn": "2015-10-29T02:47:49Z",
      "side": 1,
      "message": "As for FOR_UNIT\u003d\u003d0, I think I did that because the FOR_MDTS is currently a subset of FOR_UNIT (so the UNIT_REGEX includes all of the files/dirs in the MDTS_REGEX).  You are correct, though, in that this might not always be the case.  In which case a FOR_UNIT \u003d\u003d 0 \u0026\u0026 FOR_MDTS \u003d\u003d 0 would seem better.  Basically, any file that is in both REGEXes (and hence will be grep -v\u0027d) will trigger a NO CHANGES/FAST BUILD.\n\nAs for line 77, I\u0027m not sure I see the problem very well.  If I edit a file not in either regex, FOR_UNIT and FOR_MDTS will be 1, but to recommend a fast build that file has to be a) build.gradle and b) match the conditions lower in the code block.  Also, I don\u0027t see how I can edit a file in the MDTS_REGEX and get FOR_MDTS\u003d1 based on the grep you already had in place.  Did you mean edit a UNIT_REGEX file and get FOR_MDTS\u003d1?  That\u0027s true, but in my conditional, the FOR_UNIT\u003d\u003d0 should catch that case.  I am probably missing something, but unfortunately, I still don\u0027t see it.",
      "parentUuid": "9ab29df4_b02b65ea",
      "revId": "b24baacd6c5564ab1cfb9aea5c027fd16700c1e2",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9ab29df4_42c40892",
        "filename": "what_ci_targets.sh",
        "patchSetId": 2
      },
      "lineNbr": 83,
      "author": {
        "id": 1003629
      },
      "writtenOn": "2015-10-27T09:03:12Z",
      "side": 1,
      "message": "I might be wrong, but just thinking about it off the top of my head, I think a change to a different part of the build.gradle file that happened to have \"midonetVersion\" added would also count as a \"version bump only\" change with this grep.\n\nSo, \n\n  - \u0027rhelTarget \u003d \"7\"\n  + \u0027rhelTarget \u003d \"midonetVersion \u003d \"5.0.0-rc6\"\"\n\n(or anything similar) seems like it might still miss the full check.\n\nBasically we are checking that + and - are the same (so it\u0027s a single change, not an add or remove) and that the added portion has \"midonetVersion\" in it, but not checking that the removed portion also had midonetVersion in it.\n\nAgain, this is a very unhappy-path edge case, but I\u0027ve seen stranger things happen with vi and fat fingers before. :)  Should be caught in code review, sure, but just in the name of completeness...",
      "range": {
        "startLine": 83,
        "startChar": 2,
        "endLine": 83,
        "endChar": 80
      },
      "revId": "b24baacd6c5564ab1cfb9aea5c027fd16700c1e2",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9ab29df4_62a02c91",
        "filename": "what_ci_targets.sh",
        "patchSetId": 2
      },
      "lineNbr": 83,
      "author": {
        "id": 1002731
      },
      "writtenOn": "2015-10-27T10:13:05Z",
      "side": 1,
      "message": "The change in the example breaks the build.\n\nAnyway, yes, you can hack the recommendation by introducing a change that gets detected as a version bump AND does not break the build.  The only consequence here is that you might get a +1 from Jenkins. But reviewers will -2.\n\nHaving a more intelligent script that essentially does a code review of changes to build.gradle would be awesome, but IMO is out of scope here: the script\u0027s job is to offer recommendations for CI targets; detecting malicious patches is code reviewers job.",
      "parentUuid": "9ab29df4_42c40892",
      "range": {
        "startLine": 83,
        "startChar": 2,
        "endLine": 83,
        "endChar": 80
      },
      "revId": "b24baacd6c5564ab1cfb9aea5c027fd16700c1e2",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9ab29df4_90d8211f",
        "filename": "what_ci_targets.sh",
        "patchSetId": 2
      },
      "lineNbr": 83,
      "author": {
        "id": 1002731
      },
      "writtenOn": "2015-10-28T18:24:35Z",
      "side": 1,
      "message": "Mike, your suggestion (JIRA) was to replace here for this:\n\n  LINES_REMOVED\u003d`git diff HEAD~1 build.gradle | grep -E \"^\\- \" | wc -l | xargs`\n  LINES_ADDED\u003d`git diff HEAD~1 build.gradle | grep -E \"^\\+ \" | wc -l | xargs`\n\n  MNV_LINES_REMOVED\u003d`git diff HEAD~1 build.gradle | grep -E \"^\\- \" | grep midonetVersion | wc -l`\n  MNV_LINES_ADDED\u003d`git diff HEAD~1 build.gradle | grep -E \"^\\+ \" | grep midonetVersion | wc -l`\n\n  # If only one line was changed and it was the midonetVersion line:\n  if [ \".$LINES_ADDED\" \u003d\u003d \".1\" ] \u0026\u0026\n     [ \".$LINES_REMOVED\" \u003d\u003d \".1\" ] \u0026\u0026\n     [ \".$MNV_LINES_REMOVED\" \u003d\u003d \".1\" ] \u0026\u0026\n     [ \".$MNV_LINES_ADDED\" \u003d\u003d \".1\" ]\n\nI preferred to differenciate ADDED and REMOVED, but for our purposes the change is good enough as it tells us whether there is any change that is not on midonetVersion, which does the same as the 2 MVN_ greps. So just conciseness.",
      "parentUuid": "9ab29df4_62a02c91",
      "range": {
        "startLine": 83,
        "startChar": 2,
        "endLine": 83,
        "endChar": 80
      },
      "revId": "b24baacd6c5564ab1cfb9aea5c027fd16700c1e2",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9ab29df4_4b1dfc0e",
        "filename": "what_ci_targets.sh",
        "patchSetId": 2
      },
      "lineNbr": 83,
      "author": {
        "id": 1003629
      },
      "writtenOn": "2015-10-29T02:47:49Z",
      "side": 1,
      "message": "I\u0027ll preface this by saying I can always be wrong (and I always think as much, and I am nowhere near perfect, so I say nothing as \"gospel\"), but I think in this case \"conciseness\" comes at the expense of \"correctness\".  My proposal was a little more verbose, true, but it seems to catch the edge conditions I was mentioning at negligible cost in terms of runtime or complexity (one extra grep will hardly be noticed in this kind of code-examination-style script).  And I think the edge case I pointed out shows a difference in the two greps, so if I am not mistaken, it looks like we might end up making the code one line shorter, but at the cost of exposing the edge case.\n\nAs a matter of this particular case, it\u0027s not something I would hold up the change, but I think conciseness in general should only come as long as its not at the expense of completeness or correctness. \n\nAgain, this is just based on my current understanding, and it\u0027s mostly just for conversational purpose, as I will add my +1 either way, so we don\u0027t get held up.",
      "parentUuid": "9ab29df4_90d8211f",
      "range": {
        "startLine": 83,
        "startChar": 2,
        "endLine": 83,
        "endChar": 80
      },
      "revId": "b24baacd6c5564ab1cfb9aea5c027fd16700c1e2",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9ab29df4_e2d51c44",
        "filename": "what_ci_targets.sh",
        "patchSetId": 2
      },
      "lineNbr": 84,
      "author": {
        "id": 1003629
      },
      "writtenOn": "2015-10-27T09:03:12Z",
      "side": 1,
      "message": "Should this be LINES_ADDED?",
      "range": {
        "startLine": 84,
        "startChar": 40,
        "endLine": 84,
        "endChar": 53
      },
      "revId": "b24baacd6c5564ab1cfb9aea5c027fd16700c1e2",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9ab29df4_427c0821",
        "filename": "what_ci_targets.sh",
        "patchSetId": 2
      },
      "lineNbr": 84,
      "author": {
        "id": 1002731
      },
      "writtenOn": "2015-10-27T10:13:05Z",
      "side": 1,
      "message": "indeed",
      "parentUuid": "9ab29df4_e2d51c44",
      "range": {
        "startLine": 84,
        "startChar": 40,
        "endLine": 84,
        "endChar": 53
      },
      "revId": "b24baacd6c5564ab1cfb9aea5c027fd16700c1e2",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    }
  ]
}