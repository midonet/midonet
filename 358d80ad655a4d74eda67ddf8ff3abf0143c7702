{
  "comments": [
    {
      "key": {
        "uuid": "5aa745d1_05e764e5",
        "filename": "midonet-cluster/src/main/scala/org/midonet/cluster/services/c3po/translators/ListenerV2Translator.scala",
        "patchSetId": 14
      },
      "lineNbr": 58,
      "author": {
        "id": 1003629
      },
      "writtenOn": "2016-12-08T02:20:12Z",
      "side": 1,
      "message": "This is superfluous, however.  Removing.",
      "range": {
        "startLine": 58,
        "startChar": 0,
        "endLine": 58,
        "endChar": 91
      },
      "revId": "358d80ad655a4d74eda67ddf8ff3abf0143c7702",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "5aa745d1_2594a035",
        "filename": "midonet-cluster/src/main/scala/org/midonet/cluster/services/c3po/translators/ListenerV2Translator.scala",
        "patchSetId": 14
      },
      "lineNbr": 60,
      "author": {
        "id": 1002740
      },
      "writtenOn": "2016-12-08T01:09:58Z",
      "side": 1,
      "message": "So can we just use midonet router port which would reflect the actual IP set on this router?  We can do it in the next patch but wondering if this was looked into.",
      "revId": "358d80ad655a4d74eda67ddf8ff3abf0143c7702",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "5aa745d1_25e260d6",
        "filename": "midonet-cluster/src/main/scala/org/midonet/cluster/services/c3po/translators/ListenerV2Translator.scala",
        "patchSetId": 14
      },
      "lineNbr": 60,
      "author": {
        "id": 1003629
      },
      "writtenOn": "2016-12-08T02:20:12Z",
      "side": 1,
      "message": "The actual fetch below IS of the MidoNet Port on the router, so it is actually fetching the set address on the router port (the peer to the VIP port).  The exists check is just to make sure the peer (i.e. the VIP port) is an actual port that exists in neutron.\n\nThe reason I check for the existence of a Neutron Port, is that there could be router ports with peers that are not neutron ports (I\u0027m thinking like maybe the HM port which goes to userspace, or any other port which was attached to this router through the CLI), which we do NOT want to consider, because that might pull either a faulty address, or be missing the address altogether.  Unless someone does something VERY crazy, the only interface port on this router whose peer is a valid neutron port, would be the vip peer.  But dropping the check for the neutron port opens this up to incorrectly find many other ports on the router, such as host interface ports, user-added midonet ports, etc.\n\nHowever, if the point is to stop relying on any neutron data being in ZK, we can maybe contrive a better check, or store more valuable information with the MidoNet port (such as whether it is a vip port or not, or, more simply, the device owner, as that would be enough to determine the correct router port purely from midonet information.  But device_owner is not stored in the midonet port right now, so I can\u0027t use it).\n\nHowever we do it, I think we should go with this for now and file a JIRA to add device_owner to midonet Port (or however we decide to do it) and then remove this NeutronPort dependency from here.",
      "parentUuid": "5aa745d1_2594a035",
      "revId": "358d80ad655a4d74eda67ddf8ff3abf0143c7702",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "5aa745d1_a53c3030",
        "filename": "midonet-cluster/src/main/scala/org/midonet/cluster/services/c3po/translators/ListenerV2Translator.scala",
        "patchSetId": 14
      },
      "lineNbr": 60,
      "author": {
        "id": 1002740
      },
      "writtenOn": "2016-12-08T03:51:40Z",
      "side": 1,
      "message": "Sure, no objection to merging.  I was thinking something like this:\n\n        // In typical cases, we expect only two ports to be returned\n        val rPorts \u003d tx.getAll(classOf[Port], lbRouter.getPortIdsList.asScala)\n        val rPort \u003d rPorts.find { p \u003d\u003e\n            p.hasPeerId \u0026\u0026 p.getPeerId \u003d\u003d routerInterfacePortPeerId(p.getId)\n        }.getOrElse {\n            throw new IllegalStateException(\n                \"LB router has no router interface port which links \" +\n                \"to the VIP port\")\n        }\n        \n        bldr.setAddress(rPort.getPortAddress)\n\nBut it\u0027s making an assumption that routerInterfacePortPeerId is not used to create other ports on this router (basically, created by a translator).  Neutron doesn\u0027t see this router so it feels safe enough to me.  Change if you think it\u0027s worth changing.",
      "parentUuid": "5aa745d1_25e260d6",
      "revId": "358d80ad655a4d74eda67ddf8ff3abf0143c7702",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    }
  ]
}